<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificador de Pagamento com Parcelamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
        }
        .dates-list {
            transition: max-height 0.4s ease-out, opacity 0.3s ease-in-out, margin-top 0.4s ease-out;
        }
        #toggleIcon {
            transition: transform 0.3s ease;
        }
        .is-open #toggleIcon {
            transform: rotate(90deg);
        }
        .result.show {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.4s ease;
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 flex items-center justify-center min-h-screen p-4">

    <div class="container bg-white dark:bg-slate-800 p-6 rounded-xl shadow-2xl w-full max-w-md">
        <header class="mb-6 flex items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <img src="https://raw.githubusercontent.com/Halexandre1/PDF_PRO/main/HERBERT.jpg" alt="Log√≥tipo" class="w-12 h-12 rounded-full object-cover border-2 border-indigo-200 dark:border-indigo-800">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800 dark:text-white text-left">Verificador de Pagamento</h1>
                    <p class="text-slate-500 dark:text-slate-400 text-sm text-left">Encontre as datas corretas</p>
                </div>
            </div>
            <button id="themeToggle" class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 flex items-center justify-center transition-transform hover:scale-110" aria-label="Alternar tema">üåô</button>
        </header>
        
        <div id="datesInfo" class="bg-slate-50 dark:bg-slate-700/50 rounded-lg mb-6 border-l-4 border-indigo-500">
            <h3 id="toggleDatesHeader" class="p-4 font-semibold text-slate-700 dark:text-slate-200 cursor-pointer flex justify-between items-center">
                <span>üóìÔ∏è Datas Permitidas para Pagamento</span>
                <span id="toggleIcon" class="transform transition-transform">‚ñ∂</span>
            </h3>
            <div id="datesList" class="dates-list max-h-0 opacity-0 overflow-hidden px-4"></div>
        </div>

        <form id="paymentForm">
            <div class="mb-5">
                <label for="installments" class="block mb-2 text-sm font-medium text-slate-700 dark:text-slate-300">üî¢ N√∫mero de Parcelas:</label>
                <select id="installments" class="w-full p-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></select>
            </div>

            <div id="installments-inputs-container" class="space-y-4"></div>
            
            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-6">üîç Consultar Datas</button>
        </form>

        <div id="result" class="result opacity-0 transform translateY-5 mt-6"></div>
        
        <footer id="signature" class="mt-6 pt-4 border-t border-slate-200 dark:border-slate-700 text-center text-sm text-slate-500 dark:text-slate-400"></footer>
    </div>

    <script>
    /**
     * @file Verificador de Pagamento - Vers√£o Refatorada
     * @author HAlexandre
     * @version 2.2.0
     */

    // --- M√≥dulo de L√≥gica de Pagamento ---
    const PaymentLogic = {
        allowedPaymentDates: [
            '2025-07-03','2025-07-10','2025-07-17','2025-07-24','2025-07-31','2025-08-07','2025-08-14','2025-08-21','2025-08-28','2025-09-04','2025-09-11','2025-09-18','2025-09-25','2025-10-02','2025-10-09','2025-10-16','2025-10-23','2025-10-30','2025-11-06','2025-11-13','2025-11-19','2025-11-27','2025-12-04','2025-12-11','2025-12-18','2025-12-23','2025-12-30',
        ],

        parseDateAsUTC(dateString) {
            return new Date(dateString + 'T00:00:00Z');
        },

        findPaymentDate(dueDateString) {
            const dueDateUTC = this.parseDateAsUTC(dueDateString);
            const validDates = this.allowedPaymentDates
                .filter(dateString => this.parseDateAsUTC(dateString) <= dueDateUTC)
                .sort()
                .reverse();
            return validDates.length > 0 ? validDates[0] : null;
        }
    };

    // --- M√≥dulo de UI ---
    const UI = {
        dom: {
            paymentForm: document.getElementById('paymentForm'),
            installmentsSelect: document.getElementById('installments'),
            inputsContainer: document.getElementById('installments-inputs-container'),
            datesList: document.getElementById('datesList'),
            toggleDatesHeader: document.getElementById('toggleDatesHeader'),
            themeToggle: document.getElementById('themeToggle'),
            body: document.body,
            result: document.getElementById('result'),
            signature: document.getElementById('signature')
        },
        
        formatDateForDisplay(dateString) {
            const date = PaymentLogic.parseDateAsUTC(dateString);
            return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', timeZone: 'UTC' });
        },

        generateInstallmentInputs(count) {
            this.dom.inputsContainer.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                this.dom.inputsContainer.innerHTML += `
                    <div class="form-group">
                        <label for="dueDate-${i}" class="block mb-2 text-sm font-medium text-slate-700 dark:text-slate-300">üìÖ Vencimento da ${i}¬™ Parcela:</label>
                        <input type="date" id="dueDate-${i}" required class="w-full p-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                    </div>
                `;
            }
        },

        showResult(content, isSuccess) {
            this.dom.result.innerHTML = content;
            this.dom.result.className = `result p-4 rounded-lg text-sm font-semibold ${isSuccess ? 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300' : 'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300'}`;
            setTimeout(() => this.dom.result.classList.add('show'), 10);
        },

        populateAllowedDates() {
            const datesByMonth = PaymentLogic.allowedPaymentDates.reduce((acc, dateString) => {
                const date = PaymentLogic.parseDateAsUTC(dateString);
                const monthYear = new Intl.DateTimeFormat('pt-BR', { month: 'long', year: 'numeric', timeZone: 'UTC' }).format(date);
                const day = date.getUTCDate();
                
                if (!acc[monthYear]) {
                    acc[monthYear] = [];
                }
                acc[monthYear].push(day);
                return acc;
            }, {});

            let html = '<div class="pb-4 space-y-4">';
            for (const month in datesByMonth) {
                html += `<div>
                           <h4 class="text-sm font-bold text-slate-600 dark:text-slate-300 mb-2 capitalize">${month}</h4>
                           <div class="flex flex-wrap gap-2">
                             ${datesByMonth[month].map(day => `<span class="inline-block bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 font-semibold w-8 h-8 flex items-center justify-center rounded-full">${day}</span>`).join('')}
                           </div>
                         </div>`;
            }
            html += '</div>';
            this.dom.datesList.innerHTML = html;
        },

        loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                this.dom.themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                this.dom.themeToggle.textContent = 'üåô';
            }
        },

        setSignature() {
            this.dom.signature.innerHTML = `<p>Feito por HAlexandre ¬© ${new Date().getFullYear()}</p>`;
        }
    };

    // --- M√≥dulo Principal da Aplica√ß√£o ---
    const App = {
        init() {
            this.setupEventListeners();
            this.populateInstallmentsSelect();
            UI.generateInstallmentInputs(1);
            UI.populateAllowedDates();
            UI.loadTheme();
            UI.setSignature();
        },

        populateInstallmentsSelect() {
            for (let i = 1; i <= 10; i++) {
                UI.dom.installmentsSelect.innerHTML += `<option value="${i}">${i}x</option>`;
            }
        },

        async copyDate(buttonElement, dateString) {
            const originalText = buttonElement.innerHTML;
            try {
                await navigator.clipboard.writeText(dateString);
                buttonElement.innerHTML = '<i class="fas fa-check"></i>';
            } catch (error) {
                buttonElement.innerHTML = '<i class="fas fa-times"></i>';
            } finally {
                setTimeout(() => { buttonElement.innerHTML = originalText; }, 1500);
            }
        },

        setupEventListeners() {
            UI.dom.installmentsSelect.addEventListener('change', (e) => {
                UI.generateInstallmentInputs(parseInt(e.target.value, 10));
            });

            UI.dom.toggleDatesHeader.addEventListener('click', () => {
                const container = UI.dom.toggleDatesHeader.parentElement;
                container.classList.toggle('is-open');
                if (container.classList.contains('is-open')) {
                    UI.dom.datesList.style.maxHeight = UI.dom.datesList.scrollHeight + "px";
                    UI.dom.datesList.style.opacity = '1';
                } else {
                    UI.dom.datesList.style.maxHeight = '0';
                    UI.dom.datesList.style.opacity = '0';
                }
            });

            UI.dom.paymentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const installmentsValue = parseInt(UI.dom.installmentsSelect.value, 10);
                let installmentsPlan = [];
                let allFieldsFilled = true;

                for (let i = 1; i <= installmentsValue; i++) {
                    const dueDateInput = document.getElementById(`dueDate-${i}`);
                    if (!dueDateInput.value) {
                        allFieldsFilled = false;
                        break;
                    }
                    const paymentDate = PaymentLogic.findPaymentDate(dueDateInput.value);
                    installmentsPlan.push({
                        installment: i,
                        dueDate: dueDateInput.value,
                        paymentDate: paymentDate,
                    });
                }

                if (!allFieldsFilled) {
                    UI.showResult('‚ö†Ô∏è Por favor, preencha a data de vencimento de todas as parcelas.', false);
                    return;
                }
                
                const planHtml = installmentsPlan.map(item => {
                    const formattedDueDate = UI.formatDateForDisplay(item.dueDate);
                    let paymentInfoHtml = '';
                    if (item.paymentDate) {
                        const formattedPaymentDate = UI.formatDateForDisplay(item.paymentDate);
                        paymentInfoHtml = `<div class="flex items-center gap-2">
                            <span class="font-semibold text-green-700 dark:text-green-400">Pagar em: ${formattedPaymentDate}</span>
                            <button type="button" class="copy-btn bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-1 px-2 rounded" onclick="App.copyDate(this, '${formattedPaymentDate}')"><i class="fas fa-copy"></i></button>
                        </div>`;
                    } else {
                        paymentInfoHtml = `<span class="font-semibold text-red-600 dark:text-red-400">Data n√£o dispon√≠vel</span>`;
                    }
                    return `<li class="flex justify-between items-center bg-slate-100 dark:bg-slate-700 p-3 rounded-lg">
                        <span class="font-medium text-slate-600 dark:text-slate-300">${item.installment}¬™ Parcela (Venc: ${formattedDueDate})</span>
                        ${paymentInfoHtml}
                    </li>`;
                }).join('');

                UI.showResult(`
                    <h3 class="font-bold text-lg mb-3 text-slate-800 dark:text-white">Plano de Pagamento</h3>
                    <ul class="space-y-2">${planHtml}</ul>
                `, true);
            });

            UI.dom.themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                const isDark = document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                UI.dom.themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            });
        }
    };

    // --- Ponto de Entrada ---
    document.addEventListener('DOMContentLoaded', () => App.init());
    
    // Anexa a fun√ß√£o de c√≥pia ao objeto window para que possa ser chamada pelo onclick
    window.App = App;

    </script>
</body>
</html>
